<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="äººç”ŸRPG">
  <meta name="theme-color" content="#0a0a0f">
  <title>ğŸ® äººç”ŸRPG</title>
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%230a0a0f' width='100' height='100' rx='20'/><text y='65' x='50' text-anchor='middle' font-size='50'>ğŸ®</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #111827;
      --bg-card: rgba(17, 24, 39, 0.8);
      --text-primary: #fff;
      --text-secondary: #9ca3af;
      --gold: #fcd34d;
      --green: #4ade80;
      --blue: #60a5fa;
      --red: #f87171;
      --purple: #a78bfa;
      --orange: #fb923c;
      --cyan: #22d3ee;
    }
    
    body {
      font-family: 'DotGothic16', sans-serif;
      background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary);
      min-height: 100vh;
      min-height: 100dvh;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      overflow-x: hidden;
    }
    
    .pixel-font { font-family: 'Press Start 2P', monospace; }
    
    .nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-around;
      background: rgba(10, 10, 15, 0.95);
      border-top: 2px solid #374151;
      padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
      z-index: 100;
      backdrop-filter: blur(10px);
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px 16px;
      border: none;
      background: none;
      color: var(--text-secondary);
      font-size: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .nav-item.active { color: var(--gold); }
    .nav-item span { font-size: 20px; }
    
    .main { padding: 16px 16px 100px; max-width: 500px; margin: 0 auto; }
    
    .screen { display: none; animation: fadeIn 0.3s ease; }
    .screen.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .header-card {
      background: linear-gradient(135deg, rgba(250,204,21,0.1) 0%, rgba(0,0,0,0.6) 100%);
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 0 20px rgba(250,204,21,0.15);
    }
    
    .player-info { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
    .player-name { font-size: 18px; font-weight: bold; }
    .player-level { color: var(--gold); font-size: 12px; }
    .chapter { color: var(--text-secondary); font-size: 11px; margin-top: 4px; }
    
    .stat-bars { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
    .stat-label { display: flex; justify-content: space-between; font-size: 10px; margin-bottom: 4px; }
    .stat-label .label { display: flex; align-items: center; gap: 4px; }
    
    .progress-container {
      height: 16px;
      background: #1f2937;
      border: 2px solid #374151;
      border-radius: 2px;
      overflow: hidden;
      position: relative;
    }
    
    .progress-fill {
      height: 100%;
      transition: width 0.5s ease, background 0.3s;
      position: relative;
    }
    
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 50%;
      background: linear-gradient(180deg, rgba(255,255,255,0.3) 0%, transparent 100%);
    }
    
    .status-row { display: flex; justify-content: space-between; align-items: center; }
    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      border: 1px solid;
    }
    
    .weekly-abp { text-align: right; }
    .weekly-abp .label { font-size: 10px; color: var(--text-secondary); }
    .weekly-abp .value { font-size: 14px; }
    
    .section-card {
      background: var(--bg-card);
      border: 2px solid;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }
    
    .section-title {
      font-size: 12px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .section-title-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .quest-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(0,0,0,0.3);
      border: 1px solid #374151;
      border-radius: 8px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .quest-item:active { transform: scale(0.98); }
    .quest-item.completed { border-color: var(--green); background: rgba(74,222,128,0.1); }
    .quest-item.completed .quest-text { text-decoration: line-through; color: var(--text-secondary); }
    
    .quest-check { font-size: 20px; }
    .quest-content { flex: 1; }
    .quest-text { font-size: 13px; }
    .quest-job { font-size: 9px; margin-top: 2px; }
    .quest-level {
      font-size: 9px;
      padding: 4px 8px;
      background: rgba(250,204,21,0.2);
      color: var(--gold);
      border-radius: 10px;
    }
    
    .quest-delete {
      padding: 4px 8px;
      background: rgba(239,68,68,0.2);
      border: 1px solid var(--red);
      border-radius: 4px;
      color: var(--red);
      font-size: 10px;
      cursor: pointer;
    }
    
    .add-quest-btn {
      width: 100%;
      padding: 12px;
      border: 2px dashed #374151;
      border-radius: 8px;
      background: transparent;
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .add-quest-btn:hover { border-color: var(--cyan); color: var(--cyan); }
    
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.9);
      z-index: 200;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      animation: fadeIn 0.2s;
    }
    
    .modal-content {
      background: var(--bg-secondary);
      border-top: 2px solid var(--cyan);
      border-radius: 20px 20px 0 0;
      width: 100%;
      max-width: 500px;
      max-height: 85vh;
      overflow-y: auto;
      padding: 20px;
      animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #374151;
    }
    
    .modal-title { font-size: 16px; color: var(--cyan); }
    
    .modal-close {
      padding: 8px 16px;
      background: rgba(239,68,68,0.2);
      border: 1px solid var(--red);
      border-radius: 6px;
      color: var(--red);
      font-size: 12px;
      cursor: pointer;
    }
    
    .crystal-section {
      margin-bottom: 20px;
      padding: 12px;
      border-radius: 12px;
      background: rgba(0,0,0,0.3);
    }
    
    .crystal-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid #374151;
    }
    
    .crystal-icon {
      width: 16px;
      height: 16px;
      transform: rotate(45deg);
      border: 2px solid;
    }
    
    .crystal-name { font-size: 12px; font-weight: bold; }
    
    .ability-list { display: flex; flex-direction: column; gap: 8px; }
    
    .ability-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border: 2px solid #374151;
      border-radius: 8px;
      background: rgba(0,0,0,0.3);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .ability-item:active { transform: scale(0.98); }
    .ability-item:hover { border-color: var(--cyan); }
    
    .ability-icon { font-size: 20px; }
    .ability-content { flex: 1; }
    .ability-name { font-size: 13px; }
    .ability-desc { font-size: 10px; color: var(--text-secondary); margin-top: 2px; }
    .ability-level {
      font-size: 9px;
      padding: 4px 10px;
      border-radius: 10px;
    }
    
    .job-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
    
    .job-card {
      padding: 12px;
      background: rgba(0,0,0,0.4);
      border: 2px solid #374151;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .job-card:active { transform: scale(0.95); }
    .job-card.selected { border-color: var(--gold); box-shadow: 0 0 15px rgba(250,204,21,0.3); }
    .job-card.locked { opacity: 0.5; pointer-events: none; }
    
    .job-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 6px; }
    .job-name { font-size: 13px; font-weight: bold; }
    .job-stars { font-size: 10px; letter-spacing: -2px; }
    .job-skill { font-size: 9px; color: var(--text-secondary); margin-bottom: 6px; }
    .job-status { font-size: 8px; }
    
    .job-progress {
      height: 6px;
      background: #1f2937;
      border-radius: 2px;
      overflow: hidden;
      margin-top: 6px;
    }
    
    .job-progress-fill { height: 100%; transition: width 0.3s; }
    
    .abp-display {
      text-align: center;
      padding: 24px;
      background: linear-gradient(135deg, rgba(74,222,128,0.1) 0%, rgba(0,0,0,0.6) 100%);
      border: 2px solid var(--green);
      border-radius: 16px;
      margin-bottom: 16px;
    }
    
    .abp-label { font-size: 12px; color: var(--text-secondary); margin-bottom: 8px; }
    .abp-value { font-size: 36px; color: var(--green); text-shadow: 0 0 20px rgba(74,222,128,0.5); }
    .abp-total { font-size: 11px; color: var(--text-secondary); margin-top: 8px; }
    
    .abp-buttons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px; }
    
    .abp-btn {
      padding: 20px;
      border: 2px solid;
      border-radius: 12px;
      background: rgba(0,0,0,0.5);
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .abp-btn:active { transform: scale(0.9); }
    .abp-btn.lv1 { border-color: var(--green); color: var(--green); }
    .abp-btn.lv2 { border-color: var(--blue); color: var(--blue); }
    .abp-btn.lv3 { border-color: var(--gold); color: var(--gold); }
    .abp-btn.lv4 { border-color: var(--orange); color: var(--orange); }
    .abp-btn.lv5 { border-color: var(--purple); color: var(--purple); }
    
    .abp-btn-label { font-size: 9px; margin-top: 4px; display: block; opacity: 0.7; }
    
    .selected-job-display {
      background: rgba(250,204,21,0.1);
      border: 1px solid var(--gold);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .selected-job-name { font-size: 14px; font-weight: bold; color: var(--gold); }
    .selected-job-abp { font-size: 11px; color: var(--text-secondary); }
    
    .adjust-section { margin-bottom: 20px; }
    .adjust-label { font-size: 12px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
    .adjust-buttons { display: flex; gap: 8px; }
    
    .adjust-btn {
      flex: 1;
      padding: 12px;
      border: 2px solid #374151;
      border-radius: 8px;
      background: rgba(0,0,0,0.3);
      color: var(--text-primary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .adjust-btn:active { transform: scale(0.95); }
    .adjust-btn.hp { border-color: var(--red); }
    .adjust-btn.mp { border-color: var(--blue); }
    
    .crystal-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      overflow-x: auto;
      padding-bottom: 8px;
    }
    
    .crystal-tab {
      padding: 8px 16px;
      border: 2px solid;
      border-radius: 20px;
      background: rgba(0,0,0,0.5);
      font-size: 11px;
      white-space: nowrap;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .crystal-tab.active { box-shadow: 0 0 15px currentColor; }
    
    .level-up-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeIn 0.3s;
    }
    
    .level-up-text {
      font-size: 24px;
      color: var(--gold);
      text-shadow: 0 0 30px var(--gold);
      animation: pulse 0.5s ease infinite alternate;
      text-align: center;
    }
    
    @keyframes pulse {
      from { transform: scale(1); }
      to { transform: scale(1.1); }
    }
    
    .level-up-job { font-size: 18px; color: var(--text-primary); margin-top: 16px; }
    .level-up-stars { font-size: 32px; margin-top: 12px; }
    .level-up-close { margin-top: 32px; padding: 12px 32px; background: var(--gold); color: #000; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; }
    
    .north-star {
      text-align: center;
      padding: 20px;
      background: linear-gradient(135deg, rgba(147,51,234,0.15) 0%, rgba(0,0,0,0.6) 100%);
      border: 2px solid var(--purple);
      border-radius: 12px;
      margin-bottom: 16px;
    }
    
    .north-star-label { font-size: 10px; color: var(--text-secondary); margin-bottom: 8px; }
    .north-star-text { font-size: 16px; color: var(--purple); text-shadow: 0 0 20px rgba(147,51,234,0.5); }
    
    .title-display {
      text-align: center;
      padding: 16px;
      background: rgba(0,0,0,0.5);
      border: 1px solid #374151;
      border-radius: 8px;
    }
    
    .title-label { font-size: 10px; color: var(--text-secondary); margin-bottom: 4px; }
    .title-text { font-size: 14px; color: var(--gold); }
    
    .toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.95);
      border: 2px solid var(--green);
      border-radius: 12px;
      padding: 20px 32px;
      z-index: 500;
      animation: toastIn 0.3s ease;
      text-align: center;
    }
    
    @keyframes toastIn {
      from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
      to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }
    
    .toast-icon { font-size: 32px; margin-bottom: 8px; }
    .toast-text { font-size: 14px; }
    .toast-abp { font-size: 20px; color: var(--green); margin-top: 8px; }
    
    .hidden { display: none !important; }
    
    .empty-state {
      text-align: center;
      padding: 24px;
      color: var(--text-secondary);
      font-size: 12px;
    }
    
    /* Decay Info */
    .decay-info {
      background: rgba(239,68,68,0.1);
      border: 1px solid var(--red);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 16px;
      font-size: 11px;
    }
    
    .decay-info-title {
      color: var(--red);
      font-weight: bold;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .decay-info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
      color: var(--text-secondary);
    }
    
    .decay-info-value {
      color: var(--text-primary);
    }
    
    .decay-prevented {
      color: var(--green) !important;
    }
  </style>
</head>
<body>
  <main class="main">
    <!-- HOME SCREEN -->
    <div id="screen-home" class="screen active">
      <div class="header-card">
        <div class="player-info">
          <div>
            <div class="player-name">ä¸­æ‘æ˜Œå¼˜</div>
            <div class="player-level pixel-font">Lv.<span id="player-level">40</span></div>
            <div class="chapter">Chapter 5: çµ±åˆã¨é¸æŠ</div>
          </div>
          <div style="text-align: right; font-size: 10px; color: var(--text-secondary);">
            <div id="current-date"></div>
            <div id="current-time" class="pixel-font" style="font-size: 8px; margin-top: 4px;"></div>
          </div>
        </div>
        
        <div class="stat-bars">
          <div class="stat-bar">
            <div class="stat-label">
              <span class="label">â¤ï¸ HP</span>
              <span id="hp-value" style="color: var(--green);">72%</span>
            </div>
            <div class="progress-container">
              <div id="hp-bar" class="progress-fill" style="width: 72%; background: var(--green);"></div>
            </div>
          </div>
          <div class="stat-bar">
            <div class="stat-label">
              <span class="label">ğŸ’ MP</span>
              <span id="mp-value" style="color: var(--blue);">65%</span>
            </div>
            <div class="progress-container">
              <div id="mp-bar" class="progress-fill" style="width: 65%; background: var(--blue);"></div>
            </div>
          </div>
        </div>
        
        <div class="status-row">
          <div id="status-badge" class="status-badge" style="border-color: var(--green); color: var(--green); background: rgba(74,222,128,0.1);">
            çµ¶å¥½èª¿
          </div>
          <div class="weekly-abp">
            <div class="label">ä»Šé€±ã®ABP</div>
            <div class="value pixel-font" style="color: var(--gold);">ğŸ¯ <span id="weekly-abp">12</span> / 15</div>
          </div>
        </div>
      </div>
      
      <!-- Decay Info Card -->
      <div id="decay-info" class="decay-info hidden">
        <div class="decay-info-title">âš ï¸ æ˜¨æ—¥ã®æ¸›è¡°</div>
        <div class="decay-info-row">
          <span>åŸºæœ¬æ¸›è¡°:</span>
          <span class="decay-info-value" id="decay-base">HP -5, MP -5</span>
        </div>
        <div class="decay-info-row">
          <span>è¡Œå‹•ã«ã‚ˆã‚‹è»½æ¸›:</span>
          <span class="decay-info-value decay-prevented" id="decay-prevented">+0</span>
        </div>
        <div class="decay-info-row">
          <span>å®Ÿéš›ã®æ¸›è¡°:</span>
          <span class="decay-info-value" id="decay-actual">HP -5, MP -5</span>
        </div>
      </div>
      
      <div class="section-card" style="border-color: var(--cyan);">
        <div class="section-title" style="color: var(--cyan);">
          <div class="section-title-left">
            <span>ğŸŒŸ</span>
            <span class="pixel-font" style="font-size: 10px;">TODAY'S QUEST</span>
          </div>
          <span id="quest-count" style="font-size: 10px; color: var(--text-secondary);">0/3</span>
        </div>
        <div id="quest-list"></div>
        <button class="add-quest-btn" onclick="openQuestModal()">
          ï¼‹ ã‚¯ã‚¨ã‚¹ãƒˆã‚’è¿½åŠ 
        </button>
      </div>
      
      <div class="section-card" style="border-color: var(--orange);">
        <div class="section-title" style="color: var(--orange);">
          <div class="section-title-left">
            <span>ğŸ”¥</span>
            <span class="pixel-font" style="font-size: 10px;">è‚²æˆä¸­ã‚¸ãƒ§ãƒ–</span>
          </div>
        </div>
        <div id="training-jobs" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
      </div>
      
      <div class="north-star">
        <div class="north-star-label">ğŸ§­ åŒ—æ¥µæ˜Ÿ</div>
        <div class="north-star-text">ã€Œç«ã‚’ç¯ã—ç¶šã‘ã‚‹ã€</div>
      </div>
      
      <div class="title-display">
        <div class="title-label">ç¾åœ¨ã®ç§°å·</div>
        <div class="title-text pixel-font" style="font-size: 11px;">ã€ŒæŠ˜ã‚Œãšã«ç¶šã‘ãŸäººã€</div>
      </div>
    </div>
    
    <!-- JOBS SCREEN -->
    <div id="screen-jobs" class="screen">
      <h2 style="font-size: 16px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
        <span>âš”ï¸</span> ã‚¸ãƒ§ãƒ–ä¸€è¦§
      </h2>
      <div class="crystal-tabs" id="crystal-tabs"></div>
      <div id="job-grid" class="job-grid"></div>
    </div>
    
    <!-- ABP SCREEN -->
    <div id="screen-abp" class="screen">
      <h2 style="font-size: 16px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
        <span>âš¡</span> ABPè¨˜éŒ²
      </h2>
      
      <div id="selected-job-section">
        <div class="selected-job-display">
          <div class="selected-job-info">
            <div class="selected-job-name" id="selected-job-name">ã‚¸ãƒ§ãƒ–ã‚’é¸æŠ</div>
            <div class="selected-job-abp" id="selected-job-abp">ABP: --/--</div>
          </div>
          <button onclick="showScreen('jobs')" style="padding: 8px 16px; background: var(--gold); color: #000; border: none; border-radius: 6px; font-size: 11px; cursor: pointer;">å¤‰æ›´</button>
        </div>
      </div>
      
      <div class="abp-display">
        <div class="abp-label">ä»Šæ—¥ã®ABP</div>
        <div class="abp-value pixel-font" id="today-abp">0</div>
        <div class="abp-total">ç´¯è¨ˆ: <span id="total-abp">6,380</span> ABP</div>
      </div>
      
      <div class="abp-buttons">
        <button class="abp-btn lv1" onclick="addAbp(1)">+1<span class="abp-btn-label">Lv1</span></button>
        <button class="abp-btn lv2" onclick="addAbp(3)">+3<span class="abp-btn-label">Lv2</span></button>
        <button class="abp-btn lv3" onclick="addAbp(5)">+5<span class="abp-btn-label">Lv3</span></button>
      </div>
      <div class="abp-buttons">
        <button class="abp-btn lv4" onclick="addAbp(8)">+8<span class="abp-btn-label">Lv4</span></button>
        <button class="abp-btn lv5" onclick="addAbp(13)">+13<span class="abp-btn-label">Lv5</span></button>
      </div>
      
      <div class="section-card" style="border-color: #374151; margin-top: 16px;">
        <div class="section-title" style="color: var(--text-secondary);">
          <div class="section-title-left">
            <span>ğŸ“‹</span> ä»Šæ—¥ã®è¡Œå‹•ãƒ­ã‚°
          </div>
        </div>
        <div id="action-log" style="font-size: 12px; color: var(--text-secondary);">
          ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“
        </div>
      </div>
    </div>
    
    <!-- STATUS SCREEN -->
    <div id="screen-status" class="screen">
      <h2 style="font-size: 16px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
        <span>ğŸ“Š</span> ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹èª¿æ•´
      </h2>
      
      <!-- Decay Explanation -->
      <div class="section-card" style="border-color: var(--orange); margin-bottom: 20px;">
        <div class="section-title" style="color: var(--orange);">
          <div class="section-title-left">
            <span>ğŸ“‰</span> HP/MP è‡ªå‹•æ¸›è¡°ã‚·ã‚¹ãƒ†ãƒ 
          </div>
        </div>
        <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.6;">
          <p style="margin-bottom: 8px;">æ¯æ—¥0æ™‚ã« HP/MP ãŒè‡ªå‹•ã§æ¸›å°‘ã—ã¾ã™ã€‚</p>
          <p style="margin-bottom: 8px;"><strong style="color: var(--red);">åŸºæœ¬æ¸›è¡°:</strong> HP -5, MP -5</p>
          <p style="margin-bottom: 8px;"><strong style="color: var(--green);">è¡Œå‹•ã«ã‚ˆã‚‹è»½æ¸›:</strong></p>
          <ul style="margin-left: 16px; margin-bottom: 8px;">
            <li>ä»Šæ—¥ã®ABP 5ä»¥ä¸Š â†’ æ¸›è¡° -2</li>
            <li>ä»Šæ—¥ã®ABP 10ä»¥ä¸Š â†’ æ¸›è¡° -3</li>
            <li>ä»Šæ—¥ã®ABP 15ä»¥ä¸Š â†’ æ¸›è¡°ãªã—</li>
          </ul>
          <p style="color: var(--cyan);">ğŸ’¡ æ¯æ—¥å°‘ã—ã§ã‚‚è¡Œå‹•ã™ã‚‹ã“ã¨ã§ã€çŠ¶æ…‹ã‚’ç¶­æŒã§ãã¾ã™ã€‚</p>
        </div>
      </div>
      
      <div class="adjust-section">
        <div class="adjust-label">â¤ï¸ HP (ä½“åŠ›ãƒ»å›å¾©åŠ›)</div>
        <div class="adjust-buttons">
          <button class="adjust-btn hp" onclick="adjustStat('hp', -10)">-10</button>
          <button class="adjust-btn hp" onclick="adjustStat('hp', -5)">-5</button>
          <button class="adjust-btn hp" onclick="adjustStat('hp', 5)">+5</button>
          <button class="adjust-btn hp" onclick="adjustStat('hp', 10)">+10</button>
        </div>
        <div style="margin-top: 8px; font-size: 10px; color: var(--text-secondary);">
          HP &lt;50%: ç„¡ç†ã—ãªã„ / HP &lt;30%: Lv1ã®ã¿è¨±å¯
        </div>
      </div>
      
      <div class="adjust-section">
        <div class="adjust-label">ğŸ’ MP (ç²¾ç¥çš„ä½™ç™½)</div>
        <div class="adjust-buttons">
          <button class="adjust-btn mp" onclick="adjustStat('mp', -10)">-10</button>
          <button class="adjust-btn mp" onclick="adjustStat('mp', -5)">-5</button>
          <button class="adjust-btn mp" onclick="adjustStat('mp', 5)">+5</button>
          <button class="adjust-btn mp" onclick="adjustStat('mp', 10)">+10</button>
        </div>
        <div style="margin-top: 8px; font-size: 10px; color: var(--text-secondary);">
          MP &lt;50%: è€ƒãˆãªã„ / MP &lt;30%: åˆ¤æ–­ç³»ç¦æ­¢
        </div>
      </div>
      
      <div class="section-card" style="border-color: var(--green); margin-top: 24px;">
        <div class="section-title" style="color: var(--green);">
          <div class="section-title-left">
            <span>ğŸ’š</span> å›å¾©è¡Œå‹•
          </div>
        </div>
        <div style="display: grid; gap: 8px;">
          <button class="quest-item" onclick="doRecovery('sleep', 30, 0)" style="border-color: var(--green);">
            <span>ğŸ˜´</span>
            <span class="quest-content"><span class="quest-text">7æ™‚é–“ä»¥ä¸Šç¡çœ </span></span>
            <span style="color: var(--green); font-size: 11px;">HP +30</span>
          </button>
          <button class="quest-item" onclick="doRecovery('nap', 10, 0)" style="border-color: var(--green);">
            <span>ğŸ’¤</span>
            <span class="quest-content"><span class="quest-text">ä»®çœ 20åˆ†</span></span>
            <span style="color: var(--green); font-size: 11px;">HP +10</span>
          </button>
          <button class="quest-item" onclick="doRecovery('meditate', 0, 10)" style="border-color: var(--blue);">
            <span>ğŸ§˜</span>
            <span class="quest-content"><span class="quest-text">ç‘æƒ³5åˆ†</span></span>
            <span style="color: var(--blue); font-size: 11px;">MP +10</span>
          </button>
          <button class="quest-item" onclick="doRecovery('walk', 10, 5)" style="border-color: var(--cyan);">
            <span>ğŸš¶</span>
            <span class="quest-content"><span class="quest-text">æ•£æ­©10åˆ†</span></span>
            <span style="color: var(--cyan); font-size: 11px;">HP+10 MP+5</span>
          </button>
          <button class="quest-item" onclick="doRecovery('bath', 0, 15)" style="border-color: var(--purple);">
            <span>ğŸ›</span>
            <span class="quest-content"><span class="quest-text">å…¥æµ´ãƒ»éŸ³æ¥½</span></span>
            <span style="color: var(--purple); font-size: 11px;">MP +15</span>
          </button>
        </div>
      </div>
    </div>
  </main>
  
  <nav class="nav">
    <button class="nav-item active" onclick="showScreen('home')" data-screen="home">
      <span>ğŸ </span>HOME
    </button>
    <button class="nav-item" onclick="showScreen('jobs')" data-screen="jobs">
      <span>âš”ï¸</span>JOBS
    </button>
    <button class="nav-item" onclick="showScreen('abp')" data-screen="abp">
      <span>âš¡</span>ABP
    </button>
    <button class="nav-item" onclick="showScreen('status')" data-screen="status">
      <span>ğŸ“Š</span>STATUS
    </button>
  </nav>
  
  <div id="quest-modal" class="modal-overlay hidden" onclick="closeQuestModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title">ğŸŒŸ ã‚¯ã‚¨ã‚¹ãƒˆã‚’è¿½åŠ </div>
        <button class="modal-close" onclick="closeQuestModal()">âœ• é–‰ã˜ã‚‹</button>
      </div>
      <div id="quest-modal-content"></div>
    </div>
  </div>
  
  <div id="toast" class="toast hidden">
    <div class="toast-icon">âš¡</div>
    <div class="toast-text">ABPç²å¾—!</div>
    <div class="toast-abp pixel-font">+0</div>
  </div>
  
  <div id="level-up-overlay" class="level-up-overlay hidden">
    <div class="level-up-text pixel-font">ğŸ‰ LEVEL UP!</div>
    <div class="level-up-job" id="level-up-job">çˆ¶è¦ª</div>
    <div class="level-up-stars" id="level-up-stars">â˜…â˜…â˜† â†’ â˜…â˜…â˜…</div>
    <button class="level-up-close" onclick="closeLevelUp()">OK</button>
  </div>

  <script>
    const jobAbilities = {
      son: {
        name: "æ¯å­",
        abilities: [
          { name: "è¦ªã«é€£çµ¡ã™ã‚‹", desc: "é›»è©±ãƒ»LINEãƒ»è¨ªå•", level: 1, icon: "ğŸ“" },
          { name: "è¦ªã®è©±ã‚’è´ã", desc: "å‚¾è´ãƒ»å…±æ„Ÿ", level: 2, icon: "ğŸ‘‚" },
          { name: "è¦ªå­è¡Œã‚’ã™ã‚‹", desc: "è´ˆã‚Šç‰©ãƒ»ã‚µãƒãƒ¼ãƒˆ", level: 3, icon: "ğŸ" },
          { name: "å®¶ç³»ã®æ©‹æ¸¡ã—", desc: "è¦ªæˆšã¨ã®é–¢ä¿‚æ§‹ç¯‰", level: 4, icon: "ğŸŒ‰" },
        ]
      },
      grandchild: {
        name: "å­«",
        abilities: [
          { name: "ç¥–çˆ¶æ¯ã«é€£çµ¡", desc: "é›»è©±ãƒ»æ‰‹ç´™ãƒ»è¨ªå•", level: 1, icon: "ğŸ“±" },
          { name: "ä¸€ç·’ã«éã”ã™", desc: "æ™‚é–“ã‚’å…±æœ‰", level: 2, icon: "ğŸ‘´" },
          { name: "æ€ã„å‡ºã‚’ä½œã‚‹", desc: "ã‚¤ãƒ™ãƒ³ãƒˆãƒ»æ—…è¡Œ", level: 3, icon: "ğŸ“¸" },
          { name: "å®‰å¿ƒã‚’ä¸ãˆã‚‹", desc: "å­˜åœ¨ã§æ”¯ãˆã‚‹", level: 4, icon: "ğŸ’" },
        ]
      },
      brother: {
        name: "å…„",
        abilities: [
          { name: "å¼Ÿå¦¹ã«é€£çµ¡", desc: "è¿‘æ³ç¢ºèª", level: 1, icon: "ğŸ“²" },
          { name: "ç›¸è«‡ã«ä¹—ã‚‹", desc: "ã‚¢ãƒ‰ãƒã‚¤ã‚¹", level: 2, icon: "ğŸ’¬" },
          { name: "ä¸€ç·’ã«ä½•ã‹ã™ã‚‹", desc: "é£Ÿäº‹ãƒ»éŠã³", level: 3, icon: "ğŸ»" },
          { name: "äººç”Ÿã®ä¼´èµ°", desc: "é•·æœŸçš„ã‚µãƒãƒ¼ãƒˆ", level: 4, icon: "ğŸ¤" },
        ]
      },
      husband: {
        name: "å¤«",
        abilities: [
          { name: "æ—¥å¸¸ä¼šè©±", desc: "1æ—¥ã®å‡ºæ¥äº‹ã‚’å…±æœ‰", level: 1, icon: "ğŸ’¬" },
          { name: "å®¶äº‹åˆ†æ‹…", desc: "ç©æ¥µçš„ã«æ‹…å½“", level: 2, icon: "ğŸ " },
          { name: "æ·±ã„å¯¾è©±", desc: "ä¾¡å€¤è¦³ãƒ»å°†æ¥ã«ã¤ã„ã¦", level: 3, icon: "ğŸ’‘" },
          { name: "å…±åŒæ±ºæ–­", desc: "äººç”Ÿã®é‡è¦æ±ºå®š", level: 4, icon: "ğŸ¯" },
          { name: "è¨˜å¿µæ—¥ã‚’ç¥ã†", desc: "æ„Ÿè¬ã‚’å½¢ã«", level: 3, icon: "ğŸ‚" },
        ]
      },
      father: {
        name: "çˆ¶è¦ª",
        abilities: [
          { name: "å­ã©ã‚‚ã¨è©±ã™", desc: "10åˆ†ã®å¯¾è©±", level: 1, icon: "ğŸ‘¨â€ğŸ‘§" },
          { name: "ä¸€ç·’ã«éŠã¶", desc: "éŠã³ãƒ»å‹‰å¼·ã‚’è¦‹ã‚‹", level: 2, icon: "ğŸ®" },
          { name: "1on1å¯¾è©±", desc: "æ·±ã„ä¼šè©±ãƒ»ç›¸è«‡", level: 3, icon: "ğŸ’­" },
          { name: "æŒ‘æˆ¦ã‚’å¾ŒæŠ¼ã—", desc: "å­ã®æ±ºæ–­ã‚’æ”¯æ´", level: 4, icon: "ğŸš€" },
          { name: "èƒŒä¸­ã§èªã‚‹", desc: "è¡Œå‹•ã§ç¤ºã™", level: 5, icon: "ğŸŒŸ" },
        ]
      },
      meditator: {
        name: "ãƒ¡ãƒ‡ã‚£ãƒ†ãƒ¼ã‚¿ãƒ¼",
        abilities: [
          { name: "å‘¼å¸ã‚’æ•´ãˆã‚‹", desc: "3åˆ†ã®æ·±å‘¼å¸", level: 1, icon: "ğŸŒ¬ï¸" },
          { name: "ç‘æƒ³5åˆ†", desc: "åº§ã£ã¦é›†ä¸­", level: 2, icon: "ğŸ§˜" },
          { name: "æ„Ÿæƒ…ã‚’è¦³å¯Ÿ", desc: "æ„Ÿæƒ…ã®è¨€èªåŒ–", level: 3, icon: "ğŸ‘ï¸" },
          { name: "çŠ¶æ…‹ã‚’æ•´ãˆã‚‹", desc: "è‡ªå·±èª¿æ•´", level: 4, icon: "âš–ï¸" },
          { name: "é™å¯‚ã‚’ä¿ã¤", desc: "é•·æ™‚é–“ã®é›†ä¸­", level: 5, icon: "ğŸ”®" },
        ]
      },
      kickboxer: {
        name: "ã‚­ãƒƒã‚¯ãƒœã‚¯ã‚µãƒ¼",
        abilities: [
          { name: "ã‚¹ãƒˆãƒ¬ãƒƒãƒ", desc: "10åˆ†ã®æŸ”è»Ÿ", level: 1, icon: "ğŸ¤¸" },
          { name: "ã‚·ãƒ£ãƒ‰ãƒ¼", desc: "åŸºæœ¬å‹•ä½œç·´ç¿’", level: 2, icon: "ğŸ‘Š" },
          { name: "ã‚¸ãƒ ç·´ç¿’", desc: "æœ¬æ ¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°", level: 3, icon: "ğŸ¥Š" },
          { name: "ã‚¹ãƒ‘ãƒ¼ãƒªãƒ³ã‚°", desc: "å®Ÿæˆ¦ç·´ç¿’", level: 4, icon: "ğŸ’¥" },
          { name: "è©¦åˆå‡ºå ´", desc: "æœ¬ç•ª", level: 5, icon: "ğŸ†" },
        ]
      },
      bassist: {
        name: "ãƒ™ãƒ¼ã‚·ã‚¹ãƒˆ",
        abilities: [
          { name: "å¼¦ã«è§¦ã‚Œã‚‹", desc: "5åˆ†ã ã‘å¼¾ã", level: 1, icon: "ğŸ¸" },
          { name: "åŸºç¤ç·´ç¿’", desc: "ã‚¹ã‚±ãƒ¼ãƒ«ãƒ»é‹æŒ‡", level: 2, icon: "ğŸµ" },
          { name: "æ›²ã‚’ç·´ç¿’", desc: "1æ›²é€šã™", level: 3, icon: "ğŸ¶" },
          { name: "ã‚°ãƒ«ãƒ¼ãƒ´ç ”ç©¶", desc: "ãƒªã‚ºãƒ æ„Ÿã‚’ç£¨ã", level: 4, icon: "ğŸ¤" },
        ]
      },
      engineer: {
        name: "æŠ€è¡“å£«",
        abilities: [
          { name: "æŠ€è¡“è¨˜äº‹ã‚’èª­ã‚€", desc: "ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ", level: 1, icon: "ğŸ“–" },
          { name: "è«–æ–‡ãƒ»è³‡æ–™ä½œæˆ", desc: "æ§‹é€ åŒ–ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ", level: 2, icon: "ğŸ“" },
          { name: "æŠ€è¡“æ¤œè¨", desc: "èª²é¡Œè§£æ±º", level: 3, icon: "ğŸ”§" },
          { name: "è‹¥æ‰‹æŒ‡å°", desc: "çŸ¥è­˜ã‚’ä¼ãˆã‚‹", level: 4, icon: "ğŸ‘¨â€ğŸ«" },
          { name: "æ€æƒ³ã‚’ä½“ç³»åŒ–", desc: "å“²å­¦ãƒ¬ãƒ™ãƒ«", level: 5, icon: "ğŸ›ï¸" },
        ]
      },
      linemarketer: {
        name: "LINEãƒãƒ¼ã‚±ã‚¿ãƒ¼",
        abilities: [
          { name: "é…ä¿¡ç¢ºèª", desc: "ãƒ‡ãƒ¼ã‚¿ãƒã‚§ãƒƒã‚¯", level: 1, icon: "ğŸ“Š" },
          { name: "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ", desc: "ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ¶ä½œ", level: 2, icon: "âœï¸" },
          { name: "å°ç·šè¨­è¨ˆ", desc: "ãƒ•ãƒ­ãƒ¼æ”¹å–„", level: 3, icon: "ğŸ”€" },
          { name: "æˆ¦ç•¥ç«‹æ¡ˆ", desc: "å…¨ä½“è¨­è¨ˆ", level: 4, icon: "ğŸ“ˆ" },
          { name: "ä»•çµ„ã¿åŒ–", desc: "å†ç¾å¯èƒ½ã«", level: 5, icon: "âš™ï¸" },
        ]
      },
      employee: {
        name: "ä¼šç¤¾å“¡ï¼ˆä¸€èˆ¬ï¼‰",
        abilities: [
          { name: "æ—¥å¸¸æ¥­å‹™", desc: "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ãƒ¯ãƒ¼ã‚¯", level: 1, icon: "ğŸ’¼" },
          { name: "å ±é€£ç›¸", desc: "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³", level: 2, icon: "ğŸ“¢" },
          { name: "èª²é¡Œè§£æ±º", desc: "å•é¡Œå¯¾å¿œ", level: 3, icon: "ğŸ¯" },
          { name: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¨é€²", desc: "ãƒãƒ¼ãƒ ã‚’å‹•ã‹ã™", level: 4, icon: "ğŸš€" },
        ]
      },
      manager: {
        name: "ä¼šç¤¾å“¡ï¼ˆç®¡ç†ï¼‰",
        abilities: [
          { name: "çŠ¶æ³æŠŠæ¡", desc: "ç¾çŠ¶ç¢ºèª", level: 2, icon: "ğŸ‘€" },
          { name: "æ„æ€æ±ºå®š", desc: "åˆ¤æ–­ã‚’ä¸‹ã™", level: 3, icon: "âš–ï¸" },
          { name: "åˆæ„å½¢æˆ", desc: "ãƒãƒ¼ãƒ ã‚’ã¾ã¨ã‚ã‚‹", level: 4, icon: "ğŸ¤" },
          { name: "çµŒå–¶è¦–ç‚¹", desc: "å…¨ä½“æœ€é©", level: 5, icon: "ğŸ¢" },
        ]
      },
      coach: {
        name: "ã‚³ãƒ¼ãƒ",
        abilities: [
          { name: "è©±ã‚’è´ã", desc: "å‚¾è´", level: 1, icon: "ğŸ‘‚" },
          { name: "å•ã„ã‚’æŠ•ã’ã‚‹", desc: "æ°—ã¥ãã‚’ä¿ƒã™", level: 2, icon: "â“" },
          { name: "è¡Œå‹•è¨­è¨ˆ", desc: "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³", level: 3, icon: "ğŸ“‹" },
          { name: "äººç”Ÿå¤‰åŒ–ã‚’èµ·ã“ã™", desc: "æ·±ã„å¤‰å®¹", level: 4, icon: "ğŸ¦‹" },
          { name: "ãƒ¢ãƒ‡ãƒ«åŒ–", desc: "å†ç¾å¯èƒ½ã«", level: 5, icon: "ğŸ“" },
        ]
      },
      investor: {
        name: "æŠ•è³‡å®¶",
        abilities: [
          { name: "æƒ…å ±åé›†", desc: "å¸‚å ´èª¿æŸ»", level: 1, icon: "ğŸ“°" },
          { name: "åˆ†æ", desc: "ãƒ‡ãƒ¼ã‚¿æ¤œè¨", level: 2, icon: "ğŸ“Š" },
          { name: "æŠ•è³‡å®Ÿè¡Œ", desc: "æ„æ€æ±ºå®š", level: 3, icon: "ğŸ’°" },
          { name: "ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç®¡ç†", desc: "è³‡ç”£é…åˆ†", level: 4, icon: "ğŸ°" },
        ]
      },
      entrepreneur: {
        name: "èµ·æ¥­å®¶",
        abilities: [
          { name: "ã‚¢ã‚¤ãƒ‡ã‚¢å‡ºã—", desc: "æ§‹æƒ³ã‚’ç·´ã‚‹", level: 1, icon: "ğŸ’¡" },
          { name: "å‰¯æ¥­æ´»å‹•", desc: "å°ã•ãå§‹ã‚ã‚‹", level: 2, icon: "ğŸŒ±" },
          { name: "ä»•çµ„ã¿æ§‹ç¯‰", desc: "ã‚·ã‚¹ãƒ†ãƒ åŒ–", level: 3, icon: "âš™ï¸" },
          { name: "äº‹æ¥­æ‹¡å¤§", desc: "ã‚¹ã‚±ãƒ¼ãƒ«", level: 4, icon: "ğŸ“ˆ" },
          { name: "è‡ªèµ°çµ„ç¹”", desc: "è‡ªåˆ†ãªã—ã§å›ã‚‹", level: 5, icon: "ğŸ­" },
        ]
      },
      ceo: {
        name: "çµŒå–¶è€…",
        abilities: [
          { name: "æ„æ€æ±ºå®š", desc: "åˆ¤æ–­ã‚’ä¸‹ã™", level: 3, icon: "âš–ï¸" },
          { name: "äººã‚’å‹•ã‹ã™", desc: "ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—", level: 4, icon: "ğŸ‘¥" },
          { name: "è²¬ä»»ã‚’å–ã‚‹", desc: "å¤±æ•—ã‚’èƒŒè² ã†", level: 4, icon: "ğŸ–ï¸" },
          { name: "çµ„ç¹”è¨­è¨ˆ", desc: "æ§‹é€ ã‚’ä½œã‚‹", level: 5, icon: "ğŸ—ï¸" },
          { name: "æ¨©é™å§”è­²", desc: "ä»»ã›ã‚‹", level: 5, icon: "ğŸ”‘" },
        ]
      },
      friend: {
        name: "å‹äºº",
        abilities: [
          { name: "é€£çµ¡ã‚’å–ã‚‹", desc: "è¿‘æ³å ±å‘Š", level: 1, icon: "ğŸ“±" },
          { name: "ä¼šã£ã¦è©±ã™", desc: "é£Ÿäº‹ãƒ»å¯¾è©±", level: 2, icon: "â˜•" },
          { name: "æ·±ã„ç›¸è«‡", desc: "æœ¬éŸ³ã‚’è©±ã™", level: 3, icon: "ğŸ’¬" },
          { name: "äººç”Ÿã‚’æ”¯ãˆåˆã†", desc: "ç¯€ç›®ã§å¯„ã‚Šæ·»ã†", level: 4, icon: "ğŸ¤" },
        ]
      },
    };

    // æ¸›è¡°è¨­å®š
    const DECAY_CONFIG = {
      baseHpDecay: 5,      // åŸºæœ¬HPæ¸›è¡°
      baseMpDecay: 5,      // åŸºæœ¬MPæ¸›è¡°
      thresholds: [        // ABPã«ã‚ˆã‚‹è»½æ¸›é–¾å€¤
        { abp: 15, reduction: 5 },  // 15ABPä»¥ä¸Š: æ¸›è¡°ãªã—
        { abp: 10, reduction: 3 },  // 10ABPä»¥ä¸Š: -3è»½æ¸›
        { abp: 5, reduction: 2 },   // 5ABPä»¥ä¸Š: -2è»½æ¸›
      ]
    };

    let state = {
      hp: 72,
      mp: 65,
      weeklyAbp: 12,
      todayAbp: 0,
      totalAbp: 6380,
      selectedJob: null,
      actionLog: [],
      quests: [],
      lastDecayInfo: null,  // æ¸›è¡°æƒ…å ±ã‚’ä¿å­˜
      yesterdayAbp: 0,      // æ˜¨æ—¥ã®ABP
      jobs: {
        family: {
          name: "é¢¨ã®ã‚¯ãƒªã‚¹ã‚¿ãƒ«",
          subtitle: "å®¶æ—ãƒ»è¡€ç¸",
          color: "#4ade80",
          jobs: [
            { id: "son", name: "æ¯å­", stars: 3, maxStars: 3, level: 40, abp: 999, maxAbp: 999, status: "master", skill: "å‚¾è´ãƒ»æ„Ÿè¬" },
            { id: "grandchild", name: "å­«", stars: 3, maxStars: 3, level: 40, abp: 999, maxAbp: 999, status: "master", skill: "å…±æ„Ÿãƒ»å ´ã¥ãã‚Š" },
            { id: "brother", name: "å…„", stars: 3, maxStars: 3, level: 37, abp: 999, maxAbp: 999, status: "master", skill: "è¦‹å®ˆã‚Š" },
            { id: "husband", name: "å¤«", stars: 3, maxStars: 3, level: 2, abp: 300, maxAbp: 300, status: "master", skill: "å¯¾è©±ãƒ»æ±ºæ–­" },
            { id: "father", name: "çˆ¶è¦ª", stars: 2, maxStars: 3, level: 1, abp: 145, maxAbp: 300, status: "training", skill: "èƒŒä¸­ã§èªã‚‹" },
          ]
        },
        mind: {
          name: "æ°´ã®ã‚¯ãƒªã‚¹ã‚¿ãƒ«",
          subtitle: "å¿ƒèº«ãƒ»èª¿å’Œ",
          color: "#60a5fa",
          jobs: [
            { id: "meditator", name: "ãƒ¡ãƒ‡ã‚£ãƒ†ãƒ¼ã‚¿ãƒ¼", stars: 3, maxStars: 3, level: 1, abp: 300, maxAbp: 300, status: "master", skill: "è¦³å¯Ÿãƒ»å‘¼å¸" },
            { id: "kickboxer", name: "ã‚­ãƒƒã‚¯ãƒœã‚¯ã‚µãƒ¼", stars: 1, maxStars: 3, level: 0, abp: 15, maxAbp: 120, status: "training", skill: "èº«ä½“æ“ä½œ" },
            { id: "bassist", name: "ãƒ™ãƒ¼ã‚·ã‚¹ãƒˆ", stars: 1, maxStars: 3, level: 0, abp: 30, maxAbp: 120, status: "ä¼‘æ­¢", skill: "ãƒªã‚ºãƒ æ„Ÿ" },
          ]
        },
        work: {
          name: "ç«ã®ã‚¯ãƒªã‚¹ã‚¿ãƒ«",
          subtitle: "ä»•äº‹ãƒ»å°‚é–€æ€§",
          color: "#f87171",
          jobs: [
            { id: "engineer", name: "æŠ€è¡“å£«", stars: 3, maxStars: 3, level: 1, abp: 380, maxAbp: 300, status: "master", skill: "æ§‹é€ åŒ–" },
            { id: "linemarketer", name: "LINEãƒãƒ¼ã‚±ã‚¿ãƒ¼", stars: 2, maxStars: 3, level: 1, abp: 200, maxAbp: 300, status: "training", skill: "å°ç·šè¨­è¨ˆ" },
            { id: "employee", name: "ä¼šç¤¾å“¡ï¼ˆä¸€èˆ¬ï¼‰", stars: 3, maxStars: 3, level: 5, abp: 999, maxAbp: 999, status: "master", skill: "å®‰å®šä¾›çµ¦" },
            { id: "manager", name: "ä¼šç¤¾å“¡ï¼ˆç®¡ç†ï¼‰", stars: 0, maxStars: 3, level: 0, abp: 0, maxAbp: 120, status: "locked", skill: "åˆæ„å½¢æˆ" },
          ]
        },
        expansion: {
          name: "åœŸã®ã‚¯ãƒªã‚¹ã‚¿ãƒ«",
          subtitle: "æ‹¡å¼µãƒ»å½±éŸ¿åŠ›",
          color: "#a78bfa",
          jobs: [
            { id: "coach", name: "ã‚³ãƒ¼ãƒ", stars: 2, maxStars: 3, level: 1, abp: 200, maxAbp: 300, status: "training", skill: "å•ã„" },
            { id: "investor", name: "æŠ•è³‡å®¶", stars: 0, maxStars: 3, level: 0, abp: 0, maxAbp: 120, status: "locked", skill: "å¾…ã¤åŠ›" },
            { id: "entrepreneur", name: "èµ·æ¥­å®¶", stars: 1, maxStars: 3, level: 1, abp: 80, maxAbp: 120, status: "training", skill: "æ§‹æƒ³åŠ›" },
            { id: "ceo", name: "çµŒå–¶è€…", stars: 0, maxStars: 3, level: 0, abp: 0, maxAbp: 120, status: "locked", skill: "åˆ¤æ–­" },
            { id: "friend", name: "å‹äºº", stars: 1, maxStars: 3, level: 0, abp: 30, maxAbp: 120, status: "training", skill: "ä¼´èµ°" },
          ]
        }
      },
      activeCrystal: 'family'
    };

    function loadState() {
      const saved = localStorage.getItem('lifeRpgState');
      if (saved) {
        const parsed = JSON.parse(saved);
        state = { ...state, ...parsed };
      }
    }

    function saveState() {
      localStorage.setItem('lifeRpgState', JSON.stringify(state));
    }

    // HP/MPæ¸›è¡°ã‚’è¨ˆç®—ãƒ»é©ç”¨
    function applyDailyDecay(yesterdayAbp) {
      const { baseHpDecay, baseMpDecay, thresholds } = DECAY_CONFIG;
      
      // ABPã«ã‚ˆã‚‹è»½æ¸›ã‚’è¨ˆç®—
      let reduction = 0;
      for (const t of thresholds) {
        if (yesterdayAbp >= t.abp) {
          reduction = t.reduction;
          break;
        }
      }
      
      // å®Ÿéš›ã®æ¸›è¡°ã‚’è¨ˆç®—
      const actualHpDecay = Math.max(0, baseHpDecay - reduction);
      const actualMpDecay = Math.max(0, baseMpDecay - reduction);
      
      // HP/MPã‚’æ¸›å°‘
      state.hp = Math.max(0, state.hp - actualHpDecay);
      state.mp = Math.max(0, state.mp - actualMpDecay);
      
      // æ¸›è¡°æƒ…å ±ã‚’ä¿å­˜ï¼ˆè¡¨ç¤ºç”¨ï¼‰
      state.lastDecayInfo = {
        yesterdayAbp,
        baseDecay: { hp: baseHpDecay, mp: baseMpDecay },
        reduction,
        actualDecay: { hp: actualHpDecay, mp: actualMpDecay }
      };
      
      return state.lastDecayInfo;
    }

    // æ¸›è¡°æƒ…å ±ã‚’è¡¨ç¤º
    function showDecayInfo() {
      const info = state.lastDecayInfo;
      if (!info) {
        document.getElementById('decay-info').classList.add('hidden');
        return;
      }
      
      document.getElementById('decay-base').textContent = `HP -${info.baseDecay.hp}, MP -${info.baseDecay.mp}`;
      document.getElementById('decay-prevented').textContent = info.reduction > 0 
        ? `+${info.reduction} (ABP ${info.yesterdayAbp}é”æˆ)` 
        : '0';
      document.getElementById('decay-actual').textContent = info.actualDecay.hp === 0 && info.actualDecay.mp === 0
        ? 'æ¸›è¡°ãªã—ï¼'
        : `HP -${info.actualDecay.hp}, MP -${info.actualDecay.mp}`;
      
      if (info.reduction >= 5) {
        document.getElementById('decay-actual').classList.add('decay-prevented');
      } else {
        document.getElementById('decay-actual').classList.remove('decay-prevented');
      }
      
      document.getElementById('decay-info').classList.remove('hidden');
    }

    function calculateAge() {
      const birthDate = new Date(1985, 2, 11);
      const today = new Date();
      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }
      return age;
    }

    function updateTime() {
      const now = new Date();
      document.getElementById('current-date').textContent = now.toLocaleDateString('ja-JP');
      document.getElementById('current-time').textContent = now.toLocaleTimeString('ja-JP');
      document.getElementById('player-level').textContent = calculateAge();
    }

    function getStatusMessage() {
      if (state.hp < 30 || state.mp < 30) return { msg: "âš ï¸ ä¼‘é¤Šãƒ¢ãƒ¼ãƒ‰", color: "#f87171" };
      if (state.hp < 50) return { msg: "ç„¡ç†ã—ãªã„", color: "#fcd34d" };
      if (state.mp < 50) return { msg: "è€ƒãˆãªã„", color: "#a78bfa" };
      return { msg: "çµ¶å¥½èª¿", color: "#4ade80" };
    }

    function updateStats() {
      const hpColor = state.hp >= 70 ? '#4ade80' : state.hp >= 40 ? '#fcd34d' : '#f87171';
      const mpColor = state.mp >= 70 ? '#60a5fa' : state.mp >= 40 ? '#a78bfa' : '#f87171';
      
      document.getElementById('hp-value').textContent = state.hp + '%';
      document.getElementById('hp-value').style.color = hpColor;
      document.getElementById('hp-bar').style.width = state.hp + '%';
      document.getElementById('hp-bar').style.background = hpColor;
      
      document.getElementById('mp-value').textContent = state.mp + '%';
      document.getElementById('mp-value').style.color = mpColor;
      document.getElementById('mp-bar').style.width = state.mp + '%';
      document.getElementById('mp-bar').style.background = mpColor;
      
      const status = getStatusMessage();
      const badge = document.getElementById('status-badge');
      badge.textContent = status.msg;
      badge.style.borderColor = status.color;
      badge.style.color = status.color;
      badge.style.background = status.color + '22';
      
      document.getElementById('weekly-abp').textContent = state.weeklyAbp;
    }

    function getJobColor(jobId) {
      for (const crystal of Object.values(state.jobs)) {
        const job = crystal.jobs.find(j => j.id === jobId);
        if (job) return crystal.color;
      }
      return '#4ade80';
    }

    function renderQuests() {
      const container = document.getElementById('quest-list');
      const completed = state.quests.filter(q => q.completed).length;
      document.getElementById('quest-count').textContent = `${completed}/${state.quests.length}`;
      
      if (state.quests.length === 0) {
        container.innerHTML = '<div class="empty-state">ã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“<br>ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰è¿½åŠ ã—ã¾ã—ã‚‡ã†</div>';
        return;
      }
      
      container.innerHTML = state.quests.map((q, index) => `
        <div class="quest-item ${q.completed ? 'completed' : ''}" style="border-left: 3px solid ${q.color || '#4ade80'};">
          <span class="quest-check" onclick="toggleQuest(${index})">${q.completed ? 'âœ…' : 'â¬œ'}</span>
          <div class="quest-content" onclick="toggleQuest(${index})">
            <div class="quest-text">${q.icon || ''} ${q.name}</div>
            <div class="quest-job" style="color: ${q.color || '#9ca3af'};">${q.jobName}</div>
          </div>
          <span class="quest-level pixel-font">Lv${q.level}</span>
          <button class="quest-delete" onclick="deleteQuest(${index}); event.stopPropagation();">âœ•</button>
        </div>
      `).join('');
    }

    function toggleQuest(index) {
      const quest = state.quests[index];
      if (quest) {
        quest.completed = !quest.completed;
        if (quest.completed) {
          const abpMap = { 1: 1, 2: 3, 3: 5, 4: 8, 5: 13 };
          const abp = abpMap[quest.level] || 1;
          state.todayAbp += abp;
          state.weeklyAbp += abp;
          state.totalAbp += abp;
          
          updateJobAbp(quest.jobId, abp);
          
          state.actionLog.push({
            time: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
            job: quest.jobName,
            ability: quest.name,
            abp: abp,
            color: quest.color
          });
          
          showToast(abp);
        }
        renderQuests();
        updateStats();
        updateAbpDisplay();
        saveState();
      }
    }

    function deleteQuest(index) {
      state.quests.splice(index, 1);
      renderQuests();
      saveState();
    }

    function updateJobAbp(jobId, abp) {
      for (const crystal of Object.values(state.jobs)) {
        const job = crystal.jobs.find(j => j.id === jobId);
        if (job) {
          const oldAbp = job.abp;
          job.abp += abp;
          checkLevelUp(job, oldAbp);
          break;
        }
      }
    }

    function openQuestModal() {
      const modal = document.getElementById('quest-modal');
      const content = document.getElementById('quest-modal-content');
      
      let html = '';
      
      Object.entries(state.jobs).forEach(([crystalKey, crystal]) => {
        html += `
          <div class="crystal-section" style="border: 1px solid ${crystal.color};">
            <div class="crystal-header">
              <div class="crystal-icon" style="background: ${crystal.color}33; border-color: ${crystal.color};"></div>
              <span class="crystal-name" style="color: ${crystal.color};">${crystal.name}</span>
            </div>
            <div class="ability-list">
        `;
        
        crystal.jobs.forEach(job => {
          if (job.status === 'locked') return;
          
          const abilities = jobAbilities[job.id]?.abilities || [];
          abilities.forEach(ability => {
            const levelColors = { 1: '#4ade80', 2: '#60a5fa', 3: '#fcd34d', 4: '#fb923c', 5: '#a78bfa' };
            const color = levelColors[ability.level] || '#4ade80';
            
            html += `
              <div class="ability-item" onclick="addQuestFromAbility('${job.id}', '${job.name}', '${ability.name}', '${ability.desc}', ${ability.level}, '${ability.icon}', '${crystal.color}')">
                <span class="ability-icon">${ability.icon}</span>
                <div class="ability-content">
                  <div class="ability-name">${ability.name}</div>
                  <div class="ability-desc">${job.name} - ${ability.desc}</div>
                </div>
                <span class="ability-level pixel-font" style="background: ${color}22; color: ${color};">Lv${ability.level}</span>
              </div>
            `;
          });
        });
        
        html += '</div></div>';
      });
      
      content.innerHTML = html;
      modal.classList.remove('hidden');
    }

    function closeQuestModal(event) {
      if (event && event.target !== event.currentTarget) return;
      document.getElementById('quest-modal').classList.add('hidden');
    }

    function addQuestFromAbility(jobId, jobName, abilityName, desc, level, icon, color) {
      const exists = state.quests.some(q => q.jobId === jobId && q.name === abilityName && !q.completed);
      if (exists) {
        alert('ã“ã®ã‚¯ã‚¨ã‚¹ãƒˆã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');
        return;
      }
      
      state.quests.push({
        id: Date.now(),
        jobId: jobId,
        jobName: jobName,
        name: abilityName,
        desc: desc,
        level: level,
        icon: icon,
        color: color,
        completed: false
      });
      
      renderQuests();
      saveState();
      closeQuestModal();
      showToast(0);
      document.querySelector('.toast-icon').textContent = 'âœ¨';
      document.querySelector('.toast-text').textContent = 'ã‚¯ã‚¨ã‚¹ãƒˆè¿½åŠ !';
      document.querySelector('.toast-abp').textContent = abilityName;
      setTimeout(() => {
        document.querySelector('.toast-icon').textContent = 'âš¡';
        document.querySelector('.toast-text').textContent = 'ABPç²å¾—!';
      }, 1500);
    }

    function renderTrainingJobs() {
      const container = document.getElementById('training-jobs');
      const trainingJobs = [];
      Object.values(state.jobs).forEach(crystal => {
        crystal.jobs.forEach(job => {
          if (job.status === 'training') {
            trainingJobs.push({ ...job, color: crystal.color });
          }
        });
      });
      
      container.innerHTML = trainingJobs.map(job => `
        <span style="padding: 6px 12px; border-radius: 20px; font-size: 11px; border: 1px solid ${job.color}; color: ${job.color}; background: ${job.color}22;">
          ${job.name}
        </span>
      `).join('');
    }

    function renderCrystalTabs() {
      const container = document.getElementById('crystal-tabs');
      container.innerHTML = Object.entries(state.jobs).map(([key, crystal]) => `
        <button class="crystal-tab ${state.activeCrystal === key ? 'active' : ''}" 
                style="border-color: ${crystal.color}; color: ${crystal.color};"
                onclick="selectCrystal('${key}')">
          ${crystal.name.replace('ã®ã‚¯ãƒªã‚¹ã‚¿ãƒ«', '')}
        </button>
      `).join('');
    }

    function selectCrystal(key) {
      state.activeCrystal = key;
      renderCrystalTabs();
      renderJobGrid();
    }

    function renderJobGrid() {
      const container = document.getElementById('job-grid');
      const crystal = state.jobs[state.activeCrystal];
      
      container.innerHTML = crystal.jobs.map(job => {
        const isSelected = state.selectedJob?.id === job.id;
        const stars = 'â˜…'.repeat(job.stars) + 'â˜†'.repeat(job.maxStars - job.stars);
        const statusText = {
          'master': 'ğŸ‰ MASTER',
          'training': 'ğŸ”¥ è‚²æˆä¸­',
          'locked': 'ğŸ”’ æœªè§£æ”¾',
          'ä¼‘æ­¢': 'â¸ ä¼‘æ­¢'
        }[job.status] || '';
        
        return `
          <div class="job-card ${isSelected ? 'selected' : ''} ${job.status === 'locked' ? 'locked' : ''}"
               onclick="selectJob('${state.activeCrystal}', '${job.id}')">
            <div class="job-header">
              <div class="job-name">${job.name}</div>
              <div class="job-stars" style="color: ${crystal.color};">${stars}</div>
            </div>
            <div class="job-skill">${job.skill}</div>
            <div class="job-status" style="color: ${job.status === 'master' ? '#fcd34d' : job.status === 'training' ? '#4ade80' : '#6b7280'};">
              ${statusText}
            </div>
            <div class="job-progress">
              <div class="job-progress-fill" style="width: ${Math.min((job.abp / job.maxAbp) * 100, 100)}%; background: ${crystal.color};"></div>
            </div>
            <div style="font-size: 8px; color: #6b7280; margin-top: 4px; text-align: right;">
              ${job.abp >= 999 ? 'MAX' : job.abp + '/' + job.maxAbp} ABP
            </div>
          </div>
        `;
      }).join('');
    }

    function selectJob(crystalKey, jobId) {
      const job = state.jobs[crystalKey].jobs.find(j => j.id === jobId);
      if (job && job.status !== 'locked') {
        state.selectedJob = { ...job, crystalKey, color: state.jobs[crystalKey].color };
        renderJobGrid();
        updateSelectedJobDisplay();
        saveState();
        showScreen('abp');
      }
    }

    function updateSelectedJobDisplay() {
      if (state.selectedJob) {
        document.getElementById('selected-job-name').textContent = state.selectedJob.name;
        document.getElementById('selected-job-name').style.color = state.selectedJob.color;
        document.getElementById('selected-job-abp').textContent = `ABP: ${state.selectedJob.abp}/${state.selectedJob.maxAbp}`;
      } else {
        document.getElementById('selected-job-name').textContent = 'ã‚¸ãƒ§ãƒ–ã‚’é¸æŠ';
        document.getElementById('selected-job-name').style.color = '#fcd34d';
        document.getElementById('selected-job-abp').textContent = 'ABP: --/--';
      }
    }

    function updateAbpDisplay() {
      document.getElementById('today-abp').textContent = state.todayAbp;
      document.getElementById('total-abp').textContent = state.totalAbp.toLocaleString();
      
      const logContainer = document.getElementById('action-log');
      if (state.actionLog.length > 0) {
        logContainer.innerHTML = state.actionLog.slice(-5).reverse().map(log => `
          <div style="padding: 6px 0; border-bottom: 1px solid #374151;">
            <span>${log.time}</span> - 
            <span style="color: ${log.color || '#4ade80'};">${log.job}</span>
            ${log.ability ? `<span style="color: #9ca3af;"> (${log.ability})</span>` : ''}
            <span style="color: #4ade80;"> +${log.abp} ABP</span>
          </div>
        `).join('');
      }
    }

    function addAbp(amount) {
      if (!state.selectedJob) {
        alert('å…ˆã«ã‚¸ãƒ§ãƒ–ã‚’é¸æŠã—ã¦ãã ã•ã„');
        showScreen('jobs');
        return;
      }
      
      const canDoLevel = getMaxAllowedLevel();
      const levelMap = { 1: 1, 3: 2, 5: 3, 8: 4, 13: 5 };
      const requiredLevel = levelMap[amount] || 1;
      
      if (requiredLevel > canDoLevel) {
        alert(`ç¾åœ¨ã®HP/MPã§ã¯Lv${requiredLevel}ã®è¡Œå‹•ã¯ã§ãã¾ã›ã‚“ã€‚\nå›å¾©è¡Œå‹•ã‚’è¡Œã†ã‹ã€ä½ã„ãƒ¬ãƒ™ãƒ«ã®è¡Œå‹•ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚`);
        return;
      }
      
      state.todayAbp += amount;
      state.weeklyAbp += amount;
      state.totalAbp += amount;
      
      const crystal = state.jobs[state.selectedJob.crystalKey];
      const job = crystal.jobs.find(j => j.id === state.selectedJob.id);
      if (job) {
        const oldAbp = job.abp;
        job.abp += amount;
        state.selectedJob.abp = job.abp;
        checkLevelUp(job, oldAbp);
      }
      
      state.actionLog.push({
        time: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
        job: state.selectedJob.name,
        abp: amount,
        color: state.selectedJob.color
      });
      
      showToast(amount);
      updateAbpDisplay();
      updateSelectedJobDisplay();
      updateStats();
      saveState();
    }

    function getMaxAllowedLevel() {
      if (state.hp < 30 || state.mp < 30) return 1;
      if (state.hp < 50 || state.mp < 50) return 2;
      if (state.hp < 80 || state.mp < 50) return 3;
      if (state.hp < 80 || state.mp < 80) return 4;
      return 5;
    }

    function checkLevelUp(job, oldAbp) {
      const thresholds = [30, 120, 300];
      const oldStars = thresholds.filter(t => oldAbp >= t).length;
      const newStars = thresholds.filter(t => job.abp >= t).length;
      
      if (newStars > oldStars && newStars <= 3) {
        job.stars = newStars;
        if (newStars === 3) {
          job.status = 'master';
        }
        showLevelUp(job.name, oldStars, newStars);
      }
    }

    function showLevelUp(jobName, oldStars, newStars) {
      document.getElementById('level-up-job').textContent = jobName;
      document.getElementById('level-up-stars').textContent = 
        'â˜…'.repeat(oldStars) + 'â˜†'.repeat(3 - oldStars) + ' â†’ ' +
        'â˜…'.repeat(newStars) + 'â˜†'.repeat(3 - newStars);
      document.getElementById('level-up-overlay').classList.remove('hidden');
    }

    function closeLevelUp() {
      document.getElementById('level-up-overlay').classList.add('hidden');
      renderJobGrid();
      renderTrainingJobs();
    }

    function showToast(abp) {
      const toast = document.getElementById('toast');
      toast.querySelector('.toast-abp').textContent = '+' + abp;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 1500);
    }

    function adjustStat(stat, amount) {
      if (stat === 'hp') {
        state.hp = Math.max(0, Math.min(100, state.hp + amount));
      } else {
        state.mp = Math.max(0, Math.min(100, state.mp + amount));
      }
      updateStats();
      saveState();
    }

    function doRecovery(type, hpGain, mpGain) {
      state.hp = Math.min(100, state.hp + hpGain);
      state.mp = Math.min(100, state.mp + mpGain);
      updateStats();
      saveState();
      
      showToast(0);
      document.querySelector('.toast-icon').textContent = 'ğŸ’š';
      document.querySelector('.toast-text').textContent = 'å›å¾©!';
      document.querySelector('.toast-abp').textContent = `HP+${hpGain} MP+${mpGain}`;
      setTimeout(() => {
        document.querySelector('.toast-icon').textContent = 'âš¡';
        document.querySelector('.toast-text').textContent = 'ABPç²å¾—!';
      }, 1500);
    }

    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById('screen-' + screenId).classList.add('active');
      
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.querySelector(`[data-screen="${screenId}"]`).classList.add('active');
    }

    function init() {
      loadState();
      
      // æ—¥æ¬¡ãƒªã‚»ãƒƒãƒˆå‡¦ç†
      const now = new Date();
      const lastReset = localStorage.getItem('lastDailyReset');
      const today = now.toDateString();
      
      if (lastReset !== today) {
        // æ˜¨æ—¥ã®ABPã‚’ä¿å­˜
        const yesterdayAbp = state.todayAbp;
        
        // æ¸›è¡°ã‚’é©ç”¨
        applyDailyDecay(yesterdayAbp);
        
        // æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
        state.yesterdayAbp = yesterdayAbp;
        state.todayAbp = 0;
        state.actionLog = [];
        state.quests = state.quests.filter(q => !q.completed);
        
        // é€±æ¬¡ãƒªã‚»ãƒƒãƒˆï¼ˆæœˆæ›œæ—¥ï¼‰
        if (now.getDay() === 1) {
          const lastWeeklyReset = localStorage.getItem('lastWeeklyReset');
          const thisWeek = now.toISOString().slice(0, 10);
          if (lastWeeklyReset !== thisWeek) {
            state.weeklyAbp = 0;
            localStorage.setItem('lastWeeklyReset', thisWeek);
          }
        }
        
        localStorage.setItem('lastDailyReset', today);
        saveState();
      }
      
      updateTime();
      setInterval(updateTime, 1000);
      updateStats();
      renderQuests();
      renderTrainingJobs();
      renderCrystalTabs();
      renderJobGrid();
      updateSelectedJobDisplay();
      updateAbpDisplay();
      showDecayInfo();
    }

    init();
  </script>
</body>
</html>
